{% extends 'home.html' %}
{% load static %}
{% block content %}

<h1>{{ wishlist.name }}</h1>
<a href="{% url 'wishlist:item_create' wishlist.pk %}">Add new item</a>

<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
  {% for item in wishlist.items.all %}
  <div style="position: relative; width: 200px; border: 1px solid #ccc; padding: 10px; border-radius: 8px; text-align: center;">

      <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
      <form action="{% url 'wishlist:item_delete' item.pk %}" method="post" style="position: absolute; top: 5px; right: 5px; margin: 0;">
        {% csrf_token %}
        <button type="submit" style="
          background: #f44336; 
          border: none; 
          color: white; 
          font-weight: bold; 
          cursor: pointer; 
          border-radius: 50%; 
          width: 24px; 
          height: 24px; 
          line-height: 20px;
          padding: 0;
        ">√ó</button>
      </form>
      
      <a href="{% url 'wishlist:item_detail' item.pk %}">
        <img 
          src="{% if item.image %}{{ item.image.url }}{% else %}{% static 'images/default-gift.png' %}{% endif %}"  
          alt="{{ item.title }}" 
          style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;"
        >
      </a>
      <h3 style="margin: 10px 0 5px 0; font-size: 1.1em; color: #333;">{{ item.title }}</h3>
      {% if item.price %}
        <p style="color: #555; font-weight: bold;">{{ item.price }} –≥—Ä–Ω</p>
      {% endif %}
    </div>
  {% empty %}
    <p>No items yet.</p>
  {% endfor %}
  <p>
    <a href="#" class="copy-link" data-url="{{ request.scheme }}://{{ request.get_host }}{{ wishlist.get_absolute_url }}">üîó –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</a>
    <span class="copy-msg" style="display:none; color:green; margin-left:10px;">–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</span>
  </p>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const links = document.querySelectorAll('.copy-link');
    links.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const url = link.dataset.url;
            navigator.clipboard.writeText(url)
                .then(() => {
                    const msg = link.nextElementSibling; // <span> –ø–æ—Ä—É—á
                    msg.style.display = 'inline';
                    setTimeout(() => { msg.style.display = 'none'; }, 2000); // —Å—Ö–æ–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫
                })
                .catch(err => console.error("–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è: ", err));
        });
    });
});
</script>

{% endblock %}